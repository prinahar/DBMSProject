<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Home Page</title>
<script type="text/javascript" src="js/jquery.js"></script>
<link href="css/bootstrap.css" rel="stylesheet"/>
</head>

<body>
<div class = "container">
<h1 id='recipeTitle'> Create new recipe! </h1>
<p> Picture </p>
<p> Rating </p>
<label> Select Cuisine
<select id='cuisine'></select>
</label>
<p>
<label> Select Ingredients
<select id='ingredient' multiple></select></label>
</p>
<br />
<br />
<input type='text' id='addRecipeName' />
<p> <button id='addRecipe' class="btn-primary">Add Recipe</button> </p><br />
<input type='text' id='newIngredient' />
<select id='type'></select>
 <button id='addIngredient' class="btn-primary">Add New Ingredient</button> 



<p> <button id='order' class="btn-primary">Add to Order</button> </p>
<script>
/* $("#Type").click( function() { */
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}


$(document).ready(function() {
	

	$.ajax({
		
		url:"http://localhost:8080/mydb/rest/getPreferences",
		type:"get",
		success: function(response) {
			
			$.each(response, function(key, value)  {
				$("#cuisine").append("<option value='preference'>" + value.cuisineName + "</option>");
			});
			
		}
	});

	
	$.ajax({

		url:"http://localhost:8080/mydb/rest/getAllIngredients",
		type:"get",
		contentType:"application/json",
		success: function(response) {
			
			$.each(response, function(key, value)  {
				$("#ingredient").append("<option value='" + value.typeBean.type + "'>" + value.ingredientName + "</option>");
			});
			
		}
	});
	
 	$.ajax({
		
		url:"http://localhost:8080/mydb/rest/getAllTypes",
		type:"get",
		success: function(response) {
			
			$.each(response, function(key, value)  {
				$("#type").append("<option value='type'>" + value.type + "</option>");
			});
			
		}
	}); 
 	
 	if(getParameterByName("recipeId") != null && getParameterByName("recipeId") != "") {
		$.ajax({
			
			url:"http://localhost:8080/mydb/rest/getRecipe/" + getParameterByName("recipeId"),
			type:"get",
			success: function(response) {
				console.log(response.description);
				$("#recipeTitle").html(response.description);
				
			}
		}); 
 	}
 	$("#addIngredient").click( function() {
 	 	var newIngredient = {ingredientName: $("#newIngredient").val(), typeBean: $("#type > option:selected").text()};
 	 	console.log(newIngredient);
 	 	
 	 	$.ajax({
 			url:"http://localhost:8080/mydb/rest/addIngredient",
 			type:"post",
 			data:JSON.stringify(newIngredient),
 			dataType:"json",
 			contentType:"application/json",
 			success: function(response) {
 				$("#ingredient").empty();
 				$.each(response, function(key, value)  {
 					$("#ingredient").append("<option value='" + value.typeBean.type + "'>" + value.ingredientName + "</option>");
 				});
 			}
 		});
 	});
 	
 	$("#addRecipe").click( function() {
 		var prefIngredients = $("#ingredient > option:selected");
 		var ingredients = [];
 		for(var i = 0; i < prefIngredients.length; i++) {
 			var typetext = prefIngredients[i].value;
 		    var igredName = prefIngredients[i].innerHTML;
 			ingredients.push({'ingredientName': igredName, 'typeBean':{'type':typetext}});
 		}
 		var cuisine = $("#cuisine > option:selected").text(); 		
 	 	var newRecipe = {description:$("#addRecipeName").val(), "ingredients":ingredients , "cuisine":{cuisineName: cuisine}};
 	 	console.log(newRecipe);
 	 	
 	 	$.ajax({
 			url:"http://localhost:8080/mydb/rest/addRecipe",
 			type:"post",
 			data:JSON.stringify(newRecipe),
 			dataType:"json",
 			contentType:"application/json",
 			success: function(response) {
 				window.location.assign("recipe.html?recipeId="+response);
 			}
 		});
 	});

});

</script>

</div>


</body>
</html>